# Сборка инсталлятора

Сборка инсталлятора производится в несколько этапов: 

0. Убедиться, что в файле `pom.xml` в поле `<project.version>x.x.x.x</project.version>` указана нужная версия сборки приложения. Номер версии будет фигурировать в имени файла инсталятора и помогает  избежать путаницы в использовании инсталяторов разных версий приложения. В случае изменения номера версии в файле `pom.xml` не забываем его коммитить в репозиторий.
1. Произвести сборку проекта в *exe* файл. Сборка приложения производится с помощью команды `mvn package` (более подробно смотри раздел [Сборка приложения из консоли](build_editor.md)). 
( **Особенность:** В ходе её выполнения производится также запуск всех unit-тестов, и в случае не выполнения каких-либо из них, сборка заканчивается неудачей. Для обхода используем опцию `-Dmaven.test.skip=true`)  В результате успешного выполнения в папке target должно появиться 2 файла Sch3dEdit.exe и Sch3dEdit-with-debug-console.exe (Они оба самодостаточные, для запуска может использоваться любой из них без наличия второго. Второй аналогичен первому, но запускает дополнительно консоль, куда сыпется вывод из stdout и stderr приложения, что удобно при отладке приложения). Они оба будут помещены в инсталлятор.
2. Выполнить скрипт `preinstall.py` (python 2.7). Он создаст файлы `create_x32_installer_script.iss` и `create_x64_installer_script.iss`.
3. Убедиться, что установлена программа InnoSetup. В противном случае необходимо либо скачать с [официального сайта](http://www.jrsoftware.org/isdl.php) либо запустить установочник, появившийся после работы скрипта из п.2. (Важно: при установке InnoSetup галочку Inno Setup Preprocessor (ISPP) не снимаем.)
4. Скомпилировать скрипты `create_x64_installer_script.iss` и `create_x32_installer_script.iss` через контекстное меню проводника либо через редактор, который установился вместе с Inno Setup. Готовые установщики будут помещены в папку *Output*
5. Помечаем текущую ревизию в репозитории соответствующим тегом с номером версии и загружаем готовые инсталяторы в Bitbucket'е в разделе [загрузки](https://bitbucket.org/lwdg/sch3dedit/downloads).