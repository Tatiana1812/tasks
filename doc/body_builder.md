Билдер (интерфейс i\_BodyBuilder)
=================================

Билдер - класс, в котором хранится конкретная схема построения тела (`i_Body`). Билдеры находятся в пакете `builders`. Основной класс, у которого наследуются все билдеры - `BodyBuilder` (в нём реализованы общие методы для всех билдеров).

Класс `BodyBuilder`
-------------------

------------------------------------------------------------------------

Данные:

`String _id` - уникальный идентификатор билдера. Обращение к билдеру, как правило, происходит по ID (это же касается и якорей с телами).

`HashMap<String, BuilderParam> _params` - список параметров билдера, доступных по ключу. Ключи у разных билдеров отличаются: так, у билдера сферы по 4-м точкам ID точек доступны по ключам "A", "B", "C"; у билдера точки по координатам вектор координат доступен по ключу "P" etc.

`boolean _exists` - флаг, отслеживающий предыдущее состояние билдера. В ходе построения тела могут возникнуть ошибки: например, при попытке построить окружность по трём точкам оказывается, что эти точки лежат на одной прямой. В этом случае флаг устанавливается в FALSE. Если же построение прошло без ошибок, то флаг устанавливается в TRUE. Этот флаг используется при обработке ошибок в билдерах. В UI (User Interface) выводятся только те ошибки построения, которые сработали в первый раз, т.е. перевели флаг из положения TRUE в FALSE (иначе валились бы горы ошибок).

------------------------------------------------------------------------

Основной метод - `i_Body create(Editor edt)`

В этом методе описывается схема построения тела по известным параметрам. Если при построении не возникло ошибок, то билдер возвращает тело; флаг \_exists устанавливается в TRUE. Если же тело не построилось, то флаг \_exists устанавливается в FALSE; экземпляр тела все равно создаётся, но при помощи конструктора-пустышки (такой конструктор дополнительно описан для каждого тела). Этот конструктор создаёт тело, которое имеет лишь ID и тип, но по факту не существует.

Пример метода:

    /**
     * Создание конуса по вершине и центру основания.
     */
    public i_Body create(Editor edt){
      i_AnchorContainer anchors = edt.anchors();    // список якорей
      try {
        i_Anchor v = anchors.get((String)getValue("vertex"));    // ID вершины конуса доступен по ключу "vertex"
        i_Anchor c = anchors.get((String)getValue("center"));    // ID центра основания конуса доступен по ключу "center"
        Cone3d cone = new Cone3d(v.getPoint(), c.getPoint(), (double)getValue("radius"));    // Создаём геометрический объект конуса
        Circle3d disk = cone.getBaseCircle();
        ConeBody result = new ConeBody(_id, title(), cone);    // Создаём тело - конус
        edt.addAnchor(disk, c.id(), result, "disk");    // создаём якорь - круг (основание конуса), он автоматически будет привязан к телу
        result.addAnchor("V", v.id());    // привязываем к телу якорь - вершину
        result.addAnchor("C", c.id());    // привязываем к телу якорь - центр основания
        _exists = true;    // указываем, что тело успешно построено
        return result;    // возвращаем тело
      } catch(ExNoAnchor ex){    // в случае ошибок (по указанному ID якоря не нашлось)
        if (_exists)
          BuilderErrorHandler.statusStripWarning("Конус не построен: " + ex.getMessage());    // кидаем ошибку в UI, если построение не удалось впервые
        _exists = false;    // указываем, что тело не построено
        return new ConeBody(_id, title());    // возвращаем тело-пустышку
      }
    }
